---
phase: 01-foundation-compliance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - compliance/policies/terms-of-service.md
  - compliance/policies/content-policy.md
  - compliance/policies/age-verification-strategy.md
  - compliance/architecture-decisions/adr-001-age-verification.md
  - compliance/architecture-decisions/adr-002-whatsapp-nsfw.md
  - compliance/architecture-decisions/adr-003-audit-logging.md
autonomous: true
requirements: [SAFE-01, SAFE-02, PLAT-03]

must_haves:
  truths:
    - "Age verification strategy documents the 20+ floor enforcement via self-declaration with pluggable architecture for future methods"
    - "Content policy explicitly lists all 6 forbidden categories with enforcement approach"
    - "ToS covers AI-generated content liability, user responsibility for jailbreaking, and account deletion rights"
    - "WhatsApp NSFW architecture decision documents text-only intimate mode on WhatsApp with images via web portal"
    - "Pluggable age verification architecture is documented with interface definition and provider pattern"
  artifacts:
    - path: "compliance/policies/terms-of-service.md"
      provides: "Legal framework for AI companion platform"
      contains: "Terms of Service"
    - path: "compliance/policies/content-policy.md"
      provides: "Forbidden content categories and enforcement"
      contains: "Forbidden"
    - path: "compliance/policies/age-verification-strategy.md"
      provides: "Current and future age verification approach"
      contains: "pluggable"
    - path: "compliance/architecture-decisions/adr-001-age-verification.md"
      provides: "ADR for pluggable age verification architecture"
      contains: "AgeVerificationProvider"
    - path: "compliance/architecture-decisions/adr-002-whatsapp-nsfw.md"
      provides: "ADR for WhatsApp text-only + web portal image delivery"
      contains: "web portal"
    - path: "compliance/architecture-decisions/adr-003-audit-logging.md"
      provides: "ADR for audit log design rationale"
      contains: "audit_log"
  key_links:
    - from: "compliance/policies/content-policy.md"
      to: "compliance/policies/terms-of-service.md"
      via: "ToS references content policy"
      pattern: "content.policy"
    - from: "compliance/policies/age-verification-strategy.md"
      to: "compliance/architecture-decisions/adr-001-age-verification.md"
      via: "Strategy references ADR for technical design"
      pattern: "adr-001"
    - from: "compliance/architecture-decisions/adr-002-whatsapp-nsfw.md"
      to: "compliance/policies/content-policy.md"
      via: "ADR references content policy for what is restricted on WhatsApp"
      pattern: "content.policy"
---

<objective>
Create all policy documents and architecture decision records that define the legal and technical framework for Ava's NSFW features.

Purpose: These documents establish the compliance foundation that all future development must follow. The content policy defines what is allowed/forbidden, the ToS protects the platform legally, the age verification strategy defines the 20+ enforcement approach, and the ADRs document critical architectural decisions.

Output: 3 policy documents (ToS, content policy, age verification strategy) and 3 ADRs (pluggable age verification, WhatsApp NSFW delivery, audit logging design).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-compliance/1-CONTEXT.md
@.planning/phases/01-foundation-compliance/1-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create policy documents (ToS, content policy, age verification strategy)</name>
  <files>compliance/policies/terms-of-service.md, compliance/policies/content-policy.md, compliance/policies/age-verification-strategy.md</files>
  <action>
Create three policy documents in compliance/policies/:

**terms-of-service.md** — Draft ToS covering:
1. Service description: AI companion platform with dual-mode (secretary + intimate) functionality.
2. Eligibility: Must be 18+ to create an account. Age verification required. Declining = no access.
3. User responsibilities: Users are solely responsible for content generated through their interactions, including attempts to circumvent guardrails. Include explicit clause: "You bear legal responsibility if you attempt to jailbreak or circumvent content safety measures."
4. AI-generated content disclaimer: All characters and images are AI-generated fictional entities. The platform does not create or distribute depictions of real people.
5. Content restrictions: Reference content-policy.md for full list. State that violations result in flat refusal (no lockout, no escalation).
6. Account deletion: Users can delete their account at any time. Deletion is immediate and irreversible — all data (account, conversations, generated images) permanently removed. Audit logs are anonymized (user_id replaced).
7. Liability limitations: Platform not liable for user-generated prompts. AI outputs may be inaccurate or unexpected.
8. Governing law: Placeholder for jurisdiction (to be determined with attorney).
9. Attorney review notice: Header stating "DRAFT — Requires attorney review before publication. This document is a framework for legal counsel to refine."

**content-policy.md** — Content policy covering:
1. Platform purpose: Adult AI companion supporting intimate conversations and AI-generated imagery.
2. Allowed content: Consensual adult intimate content between user and AI character. Sexual content within spice level settings.
3. Absolutely forbidden categories (6 items, per user decision):
   - Minors in any sexual context
   - Non-consensual scenarios (rape fantasy, coercion roleplay)
   - Incest scenarios
   - Violence combined with sexual content
   - Bestiality
   - Torture
4. Enforcement approach: System-level refusal (red box system message, breaks persona). Not in-character. Flat refusal every time — no lockout, no strikes, no escalation.
5. Secretary mode boundaries: Strictly professional, hard wall. Flirting attempts met with playful deflection ("shh not now"), not engagement.
6. Spice level control: User-accessible setting (low/medium/high/max). Primarily inferred from conversation tone. Acts as floor and ceiling. "Stop" safe word exits intimate mode and lowers spice one notch.
7. Refusal message template: Include the red box design from RESEARCH.md. Tone: firm but not punitive ("We cannot" not "You are not allowed"). Brief (2-3 sentences). Names violated category. No moralistic language.
8. Future enforcement: Note that content moderation will use commercial APIs (OpenAI Moderation, Azure Content Safety) calibrated to allow legitimate intimate content while blocking forbidden categories.

**age-verification-strategy.md** — Age verification strategy covering:
1. Current approach (Phase 1): Self-declaration checkbox at signup ("I confirm that I am 18 years of age or older"). One-time, no re-verification. Declining = no access at all (not even secretary mode).
2. Data minimization: No stored proof of declaration (no timestamp, no IP logging). Log only user_id, verified: true, method: 'self-declaration' in audit_log.
3. Secondary signals: Phone account ownership (WhatsApp requires phone), payment card on file (future — implies 18+).
4. Pluggable architecture: Document the AgeVerificationProvider interface pattern (reference ADR-001). Current provider: SelfDeclarationProvider. Future providers: IDVerificationProvider (Onfido, Veriff, Jumio, Stripe Identity), BiometricProvider. Swapping is a config change, not a code rewrite.
5. 20+ floor for avatar creation: Avatar age must be 20+ minimum — no exceptions. This is enforced separately from account age verification. Hard validation on avatar age field.
6. Regulatory context: Reference 2026 state laws (Texas, Utah, Louisiana, California). Self-declaration may be challenged. Pluggable architecture enables upgrade path.
7. Upgrade path: When regulations require ID verification — implement IDVerificationProvider, change config to 'id-verification', no other code changes needed.

All documents should include: creation date, status (DRAFT), and note that attorney review is required before any are published publicly.
  </action>
  <verify>
    <automated>cd C:/Users/raphg/Desktop/IA/ava2 && test -f compliance/policies/terms-of-service.md && test -f compliance/policies/content-policy.md && test -f compliance/policies/age-verification-strategy.md && grep -q "18" compliance/policies/terms-of-service.md && grep -q "Forbidden" compliance/policies/content-policy.md && grep -qi "pluggable" compliance/policies/age-verification-strategy.md && grep -q "jailbreak" compliance/policies/terms-of-service.md && grep -q "20" compliance/policies/age-verification-strategy.md && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>Three policy documents exist. ToS covers eligibility (18+), user responsibility for jailbreaking, AI-generated content disclaimer, account deletion, and attorney review notice. Content policy lists all 6 forbidden categories with system-level refusal enforcement and spice level control. Age verification strategy documents self-declaration approach with pluggable architecture and 20+ avatar floor.</done>
</task>

<task type="auto">
  <name>Task 2: Create Architecture Decision Records</name>
  <files>compliance/architecture-decisions/adr-001-age-verification.md, compliance/architecture-decisions/adr-002-whatsapp-nsfw.md, compliance/architecture-decisions/adr-003-audit-logging.md</files>
  <action>
Create three ADRs in compliance/architecture-decisions/ using standard ADR format (Title, Status, Context, Decision, Consequences):

**adr-001-age-verification.md** — Pluggable Age Verification Architecture
- Status: Accepted
- Context: Platform serves adult content. Regulatory landscape evolving (2026 state laws requiring "commercially reasonable" verification). Current approach is self-declaration, but must be upgradeable without rearchitecting.
- Decision: Implement AgeVerificationProvider interface pattern. All verification checks go through AgeVerificationManager.verifyAge(), never check flags directly. Active provider set via configuration. Include full TypeScript interface definition:
  ```typescript
  interface AgeVerificationProvider {
    verify(userId: string, data: VerificationData): Promise<VerificationResult>;
    requiresReVerification(): boolean;
    getSessionDuration(): number;
  }
  ```
  Include SelfDeclarationProvider implementation (Phase 1) and stub IDVerificationProvider (Phase 2+).
- Consequences: Positive — future verification upgrades are config changes. Negative — slight over-engineering for Phase 1, but regulatory risk justifies it.

**adr-002-whatsapp-nsfw.md** — WhatsApp NSFW Image Delivery via Web Portal
- Status: Accepted
- Context: WhatsApp Business API explicitly prohibits sexually explicit materials or nudity. Violation = account suspension or permanent ban. Must deliver NSFW images to WhatsApp users without violating policy.
- Decision: Text-only intimate conversations on WhatsApp. NSFW images generated by backend, uploaded to private cloud storage (S3/R2), delivered via secure authenticated web portal links. Flow: generate image -> upload to storage -> create JWT-signed URL -> send link via WhatsApp text message -> user clicks to view in web portal.
  Include architecture diagram (ASCII art from RESEARCH.md Pattern 4).
  Security: JWT tokens short-lived (24h), single-use or rate-limited, HTTPS only, all access logged.
- Consequences: Positive — WhatsApp compliance maintained, web portal provides better image viewing experience. Negative — extra click for users (friction), web portal development required (Phase 6).

**adr-003-audit-logging.md** — Consolidated Audit Log Design
- Status: Accepted
- Context: Compliance requires tracking age verification, content moderation events, image generation, account deletion, and takedown requests. Need queryable, tamper-resistant log.
- Decision: Single audit_log table in PostgreSQL with JSONB event_data for flexible event payloads. Append-only (trigger prevents UPDATE/DELETE). Event categories: auth, content, moderation, account. Include schema reference to compliance/audit-schema/schema.sql.
  Data minimization: No PII beyond user_id. No IP addresses or timestamps for age verification (per user decision). Anonymize user_id on account deletion.
  Retention: 2 years minimum. Partition by month when data volume warrants it (not Phase 1).
- Consequences: Positive — single table simplifies compliance queries, JSONB provides flexibility, append-only ensures integrity. Negative — GIN index on JSONB has storage overhead, single table may need partitioning at scale.

All ADRs should include date and reference related documents (other ADRs, policy docs, schema files).
  </action>
  <verify>
    <automated>cd C:/Users/raphg/Desktop/IA/ava2 && test -f compliance/architecture-decisions/adr-001-age-verification.md && test -f compliance/architecture-decisions/adr-002-whatsapp-nsfw.md && test -f compliance/architecture-decisions/adr-003-audit-logging.md && grep -q "AgeVerificationProvider" compliance/architecture-decisions/adr-001-age-verification.md && grep -q "web portal" compliance/architecture-decisions/adr-002-whatsapp-nsfw.md && grep -q "audit_log" compliance/architecture-decisions/adr-003-audit-logging.md && echo "PASS" || echo "FAIL"</automated>
  </verify>
  <done>Three ADRs exist. ADR-001 documents pluggable age verification with TypeScript interface and SelfDeclarationProvider implementation. ADR-002 documents WhatsApp text-only + web portal architecture with security considerations. ADR-003 documents consolidated audit log design with append-only guarantees and data minimization.</done>
</task>

</tasks>

<verification>
- All 6 files exist in compliance/ directory structure
- ToS references content policy and includes attorney review notice
- Content policy lists exactly 6 forbidden categories matching user's locked decisions
- Age verification strategy documents 20+ floor AND pluggable architecture
- ADR-001 includes TypeScript interface definition for AgeVerificationProvider
- ADR-002 includes ASCII architecture diagram for WhatsApp + web portal flow
- ADR-003 references audit_log schema and documents data minimization approach
</verification>

<success_criteria>
- Policy documents are comprehensive enough for attorney review
- ADRs follow standard format and provide enough technical detail for implementation in later phases
- All user decisions from CONTEXT.md are faithfully reflected (forbidden categories, self-declaration approach, data minimization, secretary mode boundaries, spice control)
- No deferred items are implemented (no GDPR/CCPA specifics, no ID verification implementation, no watermarking)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-compliance/01-02-SUMMARY.md`
</output>
